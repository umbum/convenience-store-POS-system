<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/general.html :: header"></div>
</head>
<body class="app">
<div id="loader">
    <div class="spinner"></div>
</div>
<script>window.addEventListener('load', function load() {
    const loader = document.getElementById('loader');
    setTimeout(function () {
        loader.classList.add('fadeOut');
    }, 300);
});</script>
<div>
    <div th:replace="fragments/general.html :: sidebar"></div>
    <div class="page-container">
        <div th:replace="fragments/general.html :: navbar"></div>
        <main class="main-content bgc-grey-100">
            <div id="mainContent">
                <div class="full-container">
                    <div class="bgc-white">
                            <div class="peers fxw-nw@lg+ ai-s">
                                <div class="peer peer-greed w-70 p-20">
                                    <div class="layers">
                                        <div class="layer w-100 mB-10">
                                            <h4 class="c-grey-900">상품 판매</h4>
                                        </div>
                                        <div class="layer w-100">
                                            <table class="table" id="sales-table-head">
                                                <thead class="thead-dark">
                                                <tr>
                                                    <th scope="col">No</th>
                                                    <th scope="col">상품명</th>
                                                    <th scope="col">단가</th>
                                                    <th scope="col">수량</th>
                                                    <th scope="col">금액</th>
                                                    <th scope="col">할인</th>
                                                    <th scope="col"></th>
                                                </tr>
                                                </thead>
                                            </table>
                                            <div class="scrollable-tbody-wrapper">
                                                <table class="table" id="sales-table-body">
                                                    <tbody>
                                                    <th:block th:each="num: ${#numbers.sequence(1,20)}">
                                                        <tr>
                                                            <td data-id="no">1</td>
                                                            <td data-id="product_name">예제상품</td>
                                                            <td data-id="unit_price">100</td>
                                                            <td data-id="quantity">2</td>
                                                            <td data-id="sub_total">200</td>
                                                            <td data-id="discount"></td>
                                                            <td><i class="fa fa-times text-danger m-none"
                                                                   style="cursor: pointer;"></i></td>
                                                        </tr>
                                                    </th:block>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <table class="table" id="sales-table-foot">
                                                <tfoot>
                                                <tr>
                                                    <td></td>
                                                    <td>합계 수량 / 금액 / 할인</td>
                                                    <td></td>
                                                    <td data-id="total_quantity">150</td>
                                                    <td data-id="total">10000</td>
                                                    <td data-id="total_discount">0</td>
                                                    <td></td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="peer bdL p-20 w-30">
                                    <div class="layers">
                                        <div class="layer w-100">
                                            <div class="layers">
                                                <div class="layer w-100 mT-15">
                                                    <div class="p-30 bgc-grey-200 layer w-100 text-center">
                                                        <p></p>
                                                        <i class="ti-gift pR-10" style="font-size:30px"></i>
                                                        <p>행사 상품 정보</p>
                                                    </div>
                                                </div>
                                                <div class="layer w-100 mT-15">
                                                    <div class="input-group input-group-icon">
                                                        <span class="input-group-addon">
                                                            <span class="icon"><i class="fa fa-barcode"></i></span>
                                                        </span>
                                                        <input type="text" id="barcode" class="form-control"
                                                               placeholder="상품번호를 입력해주세요"></div>
                                                </div>
                                                <div class="layer w-100 mT-15">
                                                    <button type="button"
                                                            class="btn cur-p btn-lg btn-outline-success w-100">통합 결제
                                                    </button>
                                                </div>
                                                <div class="layer w-100 mT-15">
                                                    <button type="button"
                                                            class="btn cur-p btn-lg btn-outline-secondary w-100">서비스
                                                    </button>
                                                </div>
                                                <div class="layer w-100 mT-15">
                                                    <button type="button"
                                                            class="btn cur-p btn-lg btn-outline-info w-100">상품직접선택
                                                    </button>
                                                </div>
                                                <div class="layer w-100 mT-15">
                                                    <button type="button"
                                                            class="btn cur-p btn-lg btn-outline-danger w-100">환불
                                                    </button>
                                                </div>

                                            </div>
                                            <div class="peers pT-20 mT-20 bdT fxw-nw@lg+ jc-sb ta-c gap-10">
                                                <div class="peer">
                                                    <div class="easy-pie-chart" data-size="80" data-percent="75"
                                                         data-bar-color="#f44336"><span></span></div>
                                                    <h6 class="fsz-sm">New Users</h6></div>
                                                <div class="peer">
                                                    <div class="easy-pie-chart" data-size="80" data-percent="50"
                                                         data-bar-color="#2196f3"><span></span></div>
                                                    <h6 class="fsz-sm">New Purchases</h6></div>
                                                <div class="peer">
                                                    <div class="easy-pie-chart" data-size="80" data-percent="90"
                                                         data-bar-color="#ff9800"><span></span></div>
                                                    <h6 class="fsz-sm">Bounce Rate</h6></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </main>
        <footer class="bdT ta-c p-30 lh-0 fsz-sm c-grey-600"><span>Copyright © 2017 Designed by <a
                href="https://colorlib.com" target="_blank" title="Colorlib">Colorlib</a>. All rights reserved.</span>
        </footer>
    </div>
</div>
<script type="text/javascript" src="../assets/common/vendor.js"></script>
<script type="text/javascript" src="../assets/common/bundle.js"></script>
<script type="text/javascript" src="../custom/jquery-3.4.1.js"></script>

<script>
    // ajax로 요청 후 받아와서
    // table에 삽입하고 합계 갱신하는 함수
    $(function () {
        $('#barcode').keydown(function(e) {
            if (e.keyCode === 13) {
                var product_info = requestProductInfo($("#barcode").val());
                $("#barcode").val("");

                // if product_info is valid
                addRow(product_info);
                // else
                // pnotify?? 같은걸 띄워주자.

            }
        });

        function requestProductInfo() {
            // ajax로 요청해서 product info를 리턴하자.
            // 그냥 간단하게 json으로 하자 별도 객체 만들지 말고
        }

        function addRow(data) {
            // 테이블의 끝에 row 추가
            $("#sales-table-body")

            updateTotal();
            updateEventInfoSection();
        }

        function updateEventInfoSection() {

        }

        function updateTotal() {
            // table.column(4).data().reduce(function (a, b) {
            //     return a + b;
            // });
        }

        function removeRow(row) {
            // icon이 눌렸을 때 removeRow(자기자신) 이렇게 호출하고 이 함수에서 dom제거하면 되겠고
            updateTotal();
        }
    });


</script>
</body>
</html>